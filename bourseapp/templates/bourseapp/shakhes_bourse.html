<!-- Styles -->
    <style>
        #chartdiv {
            width: 100%;
            height: 500px;
            margin-top: -30px;
        }

    </style>

    <input type="hidden" id="url-chart-shakes" data-url="{% url 'api-bourseapp:chart-bazaar-view' %}" />



    <!-- Resources -->
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

    <!-- Chart code -->
    <script>
        am4core.ready(function() {

        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        // Create chart instance
            var chart = am4core.create("chartdiv", am4charts.XYChart);

            // Add data
            {#chart.data = generateChartData();#}

            fetchChart(function (chartData) {
                chart.data = chartData;

                // Create axes
                var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
                dateAxis.renderer.minGridDistance = 50;

                var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

                // Create series
                var series = chart.series.push(new am4charts.LineSeries());
                series.dataFields.valueY = "visits";
                series.dataFields.dateX = "date";
                series.strokeWidth = 2;
                series.minBulletDistance = 10;
                series.tooltipText = "{valueY}";
                series.tooltip.pointerOrientation = "vertical";
                series.tooltip.background.cornerRadius = 20;
                series.tooltip.background.fillOpacity = 0.5;
                series.tooltip.label.padding(12,12,12,12)

                // Add scrollbar
                chart.scrollbarX = new am4charts.XYChartScrollbar();
                chart.scrollbarX.series.push(series);

                // Add cursor
                chart.cursor = new am4charts.XYCursor();
                chart.cursor.xAxis = dateAxis;
                chart.cursor.snapToSeries = series;
                //chart.dataDateFormat = "fa-IR";
            });

            function generateChartData() {
                var chartData = [];
                {#var firstDate = new Date();#}

                //-- set first date and add one day to scroll today --//
                var dateString  = "20170614";
                var year        = dateString.substring(0,4);
                var month       = dateString.substring(4,6);
                var day         = dateString.substring(6,8);

                var firstDate   = new Date(year, month-1, day);


                firstDate.setDate(firstDate.getDate());
                var visits = 1200;
                var m_data = [79465.7, 79285, 78990.4, 78859.2, 78867.5, 78736.2, 78652.7, 78665.5, 78704.5, 78799.7, 78765.3, 78659.2, 78632.5, 78700.2, 78881.6, 78985.4, 79377, 79490.4, 79509.6, 79658.9, 79620.8, 79692.9, 79735.7, 80162.5, 80670.8, 80863, 80933.9, 81181.7, 81509.3, 81420.9, 81491.4, 81533.5, 81415.9, 81265.9, 81384.1, 81285.7, 81313.9, 81579.3, 81763.1, 81661.5, 81659.3, 81696.3, 81741.9, 81954.9, 82016.2, 82075, 82372.4, 82541.8, 82897.1, 82885, 83012.1, 83252, 83272.9, 83428.2, 83345.2, 83452.1, 83733.5, 83675.3, 83255.7, 83369.1, 83469.2, 83523.8, 83683.2, 83916.6, 84414.5, 85343.9, 85831.8, 85798.4, 85588.8, 85516.9, 85628.8, 85819, 85514.9, 85355, 85429.5, 85069.5, 84564.9, 84611.6, 84734.4, 84744.1, 85263.6, 85394.9, 85590.7, 85660, 85768, 86430.5, 86480.2, 86346.2, 86529.2, 86636.8, 86935.4, 87416.6, 87477.2, 87649.9, 87844.9, 87868.6, 87905.1, 87843.7, 87883.1, 87897.4, 87795.2, 87744.7, 87832.5, 87949.8, 88005.9, 88202.3, 88261.2, 88774.6, 89339.1, 90469.5, 90655.5, 91255.2, 91152.2, 91296.7, 90951.8, 90936.6, 91092.2, 91160.3, 91198.9, 91552.4, 92628.9, 93283.7, 94606.4, 95600.7, 95477.4, 95590.6, 95508.6, 96816, 97529.3, 98358.4, 98152.7, 97899.1, 97211.4, 95561.5, 96207.9, 96241.2, 95929.4, 96270.3, 96234.5, 96332.5, 96149.2, 96185.9, 96627.5, 97228.6, 97944, 98596.9, 98923.5, 98817.2, 98221, 98628.4, 99224.7, 99522.1, 99355.5, 99414.5, 99046.1, 98557.8, 98133.5, 97718.8, 97808.1, 98033.5, 97927.5, 98299.7, 97782.7, 97924.7, 98103.3, 98347.9, 98429.6, 98148.5, 98157.3, 98176.9, 98080.2, 98098.5, 98100.8, 97961.7, 97388.7, 97354.3, 97182.6, 96991, 96860.3, 96594.5, 96028.4, 96194.4, 96314.1, 95525.9, 95577.3, 95819.6, 96289.9, 96425.9, 96489.7, 96596.6, 96938.8, 97086.1, 97150.5, 96779.8, 96341.2, 97120.7, 96748, 96287, 95987.5, 95506.2, 95522.7, 95523.8, 95265.8, 94494.2, 94299.5, 94576.3, 94796.1, 94284.4, 93805.5, 93586.9, 93612.1, 93100.6, 92849.9, 93165.9, 93605.8, 93691.1, 93891.1, 94165.8, 94703.4, 94905.9, 94940.2, 95103.1, 95136.4, 95227.4, 95229.9, 95445, 95794, 95626, 95529.6, 95409.6, 95577.6, 95951.9, 95998.8, 96077.1, 95915.9, 95847.4, 96378.7, 99146.2, 102452, 104534, 106504, 108873, 109401, 112061, 115175, 113528, 111325, 111528, 108694, 109937, 112347, 112490, 111052, 110851, 110849, 109505, 108917, 108072, 108110, 107781, 107777, 108296, 108831, 108659, 108396, 108800, 111878, 113852, 116760, 121174, 123951, 124354, 128448, 133328, 133584, 131522, 129014, 129902, 128523, 130928, 130477, 131536, 134355, 137073, 136911, 136343, 138583, 140309, 136766, 137472, 136110, 133676, 135258, 137984, 137714, 139629, 142234, 146999, 148578, 155061, 158119, 155710, 158072, 157329, 160538, 165072, 168625, 174618, 180636, 187406, 195104, 195480, 188259, 185559, 184085, 176419, 175186, 180848, 181016, 175033, 174826, 180602, 182834, 182929, 188576, 189438, 187779, 185319, 181060, 178841, 180627, 183220, 183367, 183449, 182919, 184160, 185100, 184231, 180668, 182212, 183212, 181994, 178819, 173558, 175817, 176459, 175713, 171253, 166464, 167200, 163772, 159854, 163139, 166304, 165702, 166860, 167083, 166891, 166916, 166235, 165352, 164486, 161708, 159750, 159146, 156083, 154551, 156694, 157484, 156950, 158444, 160774, 161310, 161405, 161841, 160899, 161107, 161276, 162324, 163967, 164829, 164930, 164494, 164696, 165446, 165595, 166131, 165575, 161922, 162806, 162941, 162478, 160798, 159818, 160153, 160295, 159855, 157355, 158044, 158394, 158536, 158468, 157973, 157311, 157114, 156155, 156705, 157388, 159490, 164268, 166030, 166794, 164712, 165295, 164370, 164443, 164239, 162594, 162827, 163007, 164470, 167372, 167910, 169116, 171125, 172523, 175899, 178659, 179194, 179766, 181542, 185358, 185281, 186536, 188074, 188593, 190425, 193978, 195203, 196084, 201806, 201891, 199911, 204375, 204322, 202858, 203777, 205287, 209244, 214868, 216642, 220109, 224590, 224057, 215821, 208197, 211344, 209155, 204069, 207752, 211746, 211018, 212748, 212852, 211872, 215092, 215169, 214314, 217574, 223254, 224477, 222388, 224544, 226983, 226888, 229809, 230268, 230618, 233353, 234168, 238220, 238161, 237148, 234879, 233886, 237460, 242568, 245099, 248578, 248533, 247123, 248276, 248944, 245446, 246448, 249253, 248716, 249622, 250605, 253578, 253303, 246268, 246790, 246437, 249662, 253057, 251278, 252865, 252275, 252325, 252488, 252898, 254446, 254454, 255530, 256698, 255512, 255163, 255306, 255876, 257097, 261392, 261406, 260992, 262941, 266127, 269986, 269225, 274872, 278470, 278675, 284139, 286115, 283063, 285574, 290179, 294602, 296732, 299931, 304460, 302396, 305917, 302082, 294167, 297713, 302104, 311471, 312207, 314409, 320024, 318251, 324706, 326098, 326117, 327306, 320208, 320910, 314470, 313049, 322060, 326191, 319872, 308979, 309640, 301391, 302173, 308315, 305808, 303450, 305970, 309661, 308730, 308961, 304677, 305333, 305859, 302795, 303944, 306655, 307094, 306886, 302341, 302726, 304689, 304997, 305623, 305774, 308477, 309643, 311230, 314588, 318671, 320195, 320814, 322528, 327625, 332567, 335792, 339434, 339387, 343292, 344115, 344488, 346871, 350323, 353997, 356721, 359366, 362259, 361088, 367632, 369730, 375548, 377013
                    , 384100, 367334, 365815, 358843, 353807, 359807, 375650, 392038, 395912, 399445, 409962, 410694, 409807, 406008, 410842  ];
                //-- not used, only need first date --//
                var m_labels = ["20170614", "20170617", "20170618", "20170619", "20170620", "20170621", "20170624", "20170625", "20170628", "20170701", "20170702", "20170703", "20170704", "20170705", "20170708", "20170709", "20170710", "20170711", "20170712", "20170715", "20170716", "20170717", "20170718", "20170719", "20170722", "20170723", "20170724", "20170725", "20170726", "20170729", "20170730", "20170731", "20170801", "20170802", "20170806", "20170807", "20170808", "20170809", "20170812", "20170813", "20170814", "20170815", "20170816", "20170819", "20170820", "20170821", "20170822", "20170823", "20170826", "20170827", "20170828", "20170829", "20170830", "20170902", "20170903", "20170904", "20170905", "20170906", "20170910", "20170911", "20170912", "20170913", "20170916", "20170917", "20170918", "20170919", "20170920", "20170923", "20170924", "20170925", "20170926", "20170927", "20171002", "20171003", "20171004", "20171007", "20171008", "20171009", "20171010", "20171011", "20171014", "20171015", "20171016", "20171017", "20171018", "20171021", "20171022", "20171023", "20171024", "20171025", "20171028", "20171029", "20171030", "20171031", "20171101", "20171104", "20171105", "20171106", "20171107", "20171108", "20171111", "20171112", "20171113", "20171114", "20171115", "20171118", "20171120", "20171121", "20171122", "20171125", "20171126", "20171128", "20171129", "20171202", "20171203", "20171204", "20171205", "20171209", "20171210", "20171211", "20171212", "20171213", "20171216", "20171217", "20171218", "20171219", "20171220", "20171223", "20171224", "20171225", "20171226", "20171227", "20171230", "20171231", "20180101", "20180102", "20180103", "20180106", "20180107", "20180108", "20180109", "20180110", "20180113", "20180114", "20180115", "20180116", "20180117", "20180120", "20180121", "20180122", "20180123", "20180124", "20180127", "20180128", "20180129", "20180130", "20180131", "20180203", "20180204", "20180205", "20180206", "20180207", "20180210", "20180212", "20180213", "20180214", "20180217", "20180219", "20180221", "20180224", "20180225", "20180226", "20180227", "20180228", "20180303", "20180304", "20180305", "20180306", "20180307", "20180310", "20180311", "20180312", "20180313", "20180314", "20180317", "20180318", "20180319", "20180325", "20180326", "20180327", "20180328", "20180403", "20180404", "20180407", "20180408", "20180409", "20180410", "20180411", "20180415", "20180416", "20180417", "20180418", "20180421", "20180422", "20180423", "20180424", "20180425", "20180428", "20180429", "20180430", "20180501", "20180505", "20180506", "20180507", "20180508", "20180509", "20180512", "20180513", "20180514", "20180515", "20180516", "20180519", "20180520", "20180521", "20180522", "20180523", "20180526", "20180527", "20180528", "20180529", "20180530", "20180602", "20180603", "20180609", "20180610", "20180611", "20180612", "20180613", "20180617", "20180618", "20180619", "20180620", "20180623", "20180624", "20180625", "20180626", "20180627", "20180630", "20180701", "20180702", "20180703", "20180704", "20180707", "20180708", "20180710", "20180711", "20180714", "20180715", "20180716", "20180717", "20180718", "20180721", "20180722", "20180723", "20180724", "20180725", "20180728", "20180729", "20180730", "20180731", "20180801", "20180804", "20180805", "20180806", "20180807", "20180808", "20180811", "20180812", "20180813", "20180814", "20180815", "20180818", "20180819", "20180820", "20180821", "20180825", "20180826", "20180827", "20180828", "20180829", "20180901", "20180902", "20180903", "20180904", "20180905", "20180908", "20180909", "20180910", "20180911", "20180912", "20180915", "20180916", "20180917", "20180918", "20180922", "20180923", "20180924", "20180925", "20180926", "20180929", "20180930", "20181001", "20181002", "20181003", "20181006", "20181007", "20181008", "20181009", "20181010", "20181013", "20181014", "20181015", "20181016", "20181017", "20181020", "20181021", "20181022", "20181023", "20181024", "20181027", "20181028", "20181029", "20181031", "20181103", "20181104", "20181105", "20181106", "20181110", "20181111", "20181112", "20181113", "20181114", "20181117", "20181118", "20181119", "20181120", "20181121", "20181124", "20181126", "20181127", "20181128", "20181201", "20181202", "20181203", "20181204", "20181205", "20181208", "20181209", "20181210", "20181211", "20181212", "20181215", "20181216", "20181217", "20181218", "20181219", "20181222", "20181223", "20181224", "20181225", "20181226", "20181229", "20181230", "20181231", "20190101", "20190102", "20190105", "20190106", "20190107", "20190108", "20190109", "20190112", "20190113", "20190114", "20190115", "20190116", "20190119", "20190120", "20190121", "20190122", "20190123", "20190126", "20190127", "20190128", "20190129", "20190130", "20190202", "20190203", "20190204", "20190205", "20190206", "20190210", "20190212", "20190213", "20190216", "20190217", "20190218", "20190219", "20190220", "20190223", "20190224", "20190225", "20190226", "20190227", "20190302", "20190303", "20190304", "20190305", "20190306", "20190309", "20190310", "20190311", "20190312", "20190313", "20190316", "20190317", "20190318", "20190319", "20190325", "20190326", "20190327", "20190330", "20190331", "20190406", "20190407", "20190408", "20190409", "20190410", "20190413", "20190414", "20190415", "20190416", "20190417", "20190420", "20190422", "20190423", "20190424", "20190427", "20190428", "20190429", "20190430", "20190501", "20190504", "20190505", "20190506", "20190507", "20190508", "20190511", "20190512", "20190513", "20190514", "20190515", "20190518", "20190519", "20190520", "20190521", "20190522", "20190525", "20190526", "20190528", "20190529", "20190601", "20190602", "20190603", "20190608", "20190609", "20190610", "20190611", "20190612", "20190615", "20190616", "20190617", "20190618", "20190619", "20190622", "20190623", "20190624", "20190625", "20190626", "20190630", "20190701", "20190702", "20190703", "20190706", "20190707", "20190708", "20190709", "20190710", "20190713", "20190714", "20190715", "20190716", "20190717", "20190720", "20190721", "20190722", "20190723", "20190724", "20190727", "20190728", "20190729", "20190730", "20190731", "20190803", "20190804", "20190805", "20190806", "20190807", "20190810", "20190811", "20190813", "20190814", "20190817", "20190818", "20190819", "20190821", "20190824", "20190825", "20190826", "20190827", "20190828", "20190831", "20190901", "20190902", "20190903", "20190904", "20190907", "20190908", "20190911", "20190914", "20190915", "20190916", "20190917", "20190918", "20190921", "20190922", "20190923", "20190924", "20190925", "20190928", "20190929", "20190930", "20191001", "20191002", "20191005", "20191006", "20191007", "20191008", "20191009", "20191012", "20191013", "20191014", "20191015", "20191016", "20191020", "20191021", "20191022", "20191023", "20191026", "20191028", "20191030", "20191102", "20191103", "20191104", "20191105", "20191109", "20191110", "20191111", "20191112", "20191113", "20191116", "20191117", "20191118", "20191119", "20191120", "20191123", "20191124", "20191125", "20191126", "20191127", "20191130", "20191201", "20191202", "20191203", "20191204", "20191207", "20191208", "20191209", "20191210", "20191211", "20191214", "20191215", "20191216", "20191217", "20191218", "20191221", "20191222", "20191223", "20191224", "20191225", "20191228", "20191229", "20191230", "20191231", "20200101"];

                for (var i = 0; i < m_data.length; i++) {
                    // we create date objects here. In your data, you can have date strings
                    // and then set format of your dates using chart.dataDateFormat property,
                    // however when possible, use date objects, as this will speed up chart rendering.


                    var newDate = new Date(firstDate);
                    newDate.setDate(newDate.getDate() + i);
                    {#newDate = newDate.toLocaleDateString("fa-IR")#}
                    {#let newDate = m_labels[i];#}


                    {#visits += Math.round((Math.random()<0.5?1:-1)*Math.random()*10);#}
                    let visits = m_data[i];

                    chartData.push({
                        date: newDate,
                        visits: visits
                    });
                }
                return chartData;
            }

        }); // end am4core.ready()

        function fetchChart(callBack) {

            let url_chart = document.querySelector('#url-chart-shakes').dataset.url;

             {#alert(url_chart);#}
             {#return#}

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                   // Typical action to be performed when the document is ready:
                   {#console.log(JSON.parse(xhttp.response).Date);#}

                    var chartData = [];

                    var m_data = JSON.parse(xhttp.response).Close;
                    var m_labels = JSON.parse(xhttp.response).Date;

                    m_data = m_data.substr(1,m_data.length-2);
                    m_data = m_data.split(',');
                    m_labels = m_labels.substr(1,m_labels.length-2);
                    m_labels = m_labels.split(',');

                    document.querySelector('#shakesh-last-date').innerHTML = "(" + m_labels[0].substr(1,m_labels[0].length-2) + ")";
                    document.querySelector('#shakesh-last-price').innerHTML = m_data[0];

                    for (var i = 0; i < m_data.length; i++) {
                        // we create date objects here. In your data, you can have date strings
                        // and then set format of your dates using chart.dataDateFormat property,
                        // however when possible, use date objects, as this will speed up chart rendering.

                        let newDate = m_labels[i];

                        let visits = m_data[i];

                        chartData.push({
                            date: newDate,
                            visits: visits
                        });
                    }
                    callBack(chartData);

                }
            };
            xhttp.open("GET", url_chart, true);
            xhttp.send();
        }

    </script>

    <!-- HTML -->
    <div id="chartdiv" dir="ltr"></div>